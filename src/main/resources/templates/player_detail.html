<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/default_layout}">
<head>
    <title th:text="${player.fullName} + ' - SwiftGoal'">Player Details</title>
</head>
<body>
<div layout:fragment="content">
    <div class="player-profile-header">
        <img th:src="${player.photoUrl}" th:alt="${player.fullName}" class="player-photo-large"/>
        <div>
            <h1 th:text="${player.fullName}">Player Name</h1>
            <p><strong>Nationality:</strong> <span th:text="${player.nationality}"></span></p>
            <p><strong>Position:</strong> <span th:text="${player.position}"></span></p>
            <p><strong>Date of Birth:</strong> <span th:text="${#temporals.format(player.dateOfBirth, 'dd MMM yyyy')}"></span></p>
        </div>
    </div>

    <div class="player-stats-section">
        <h2>Match Statistics (2023/2024 Season)</h2>
        <button id="load-stats-btn" class="btn btn-primary" th:attr="data-player-id=${player.id}, data-season=2023">
            Load Match Stats
        </button>
        <div id="stats-container" style="margin-top: 20px;">
            <!-- Stats will be loaded here -->
        </div>
        <div id="loading-spinner" style="display: none;">
            <p>Loading data from API... this may take a moment.</p>
        </div>
    </div>

    <script layout:fragment="scripts">
        document.getElementById('load-stats-btn').addEventListener('click', function() {
            const playerId = this.getAttribute('data-player-id');
            const season = this.getAttribute('data-season');
            const statsContainer = document.getElementById('stats-container');
            const loadingSpinner = document.getElementById('loading-spinner');
            const button = this;

            button.disabled = true;
            loadingSpinner.style.display = 'block';
            statsContainer.innerHTML = '';

            fetch(`/players/${playerId}/seasons/${season}/matches`)
                .then(response => response.json())
                .then(data => {
                    loadingSpinner.style.display = 'none';
                    button.style.display = 'none'; // Hide button after loading

                    if (data && data.length > 0) {
                        let table = '<table class="table table-sm table-striped"><thead><tr>' +
                            '<th>Date</th><th>Competition</th><th>Opponent</th><th>Result</th><th>Mins</th><th>Goals</th><th>Assists</th><th>Rating</th>' +
                            '</tr></thead><tbody>';

                        data.forEach(stat => {
                            // Logic to determine opponent and result would be needed here
                            // This is a simplified example
                            table += `<tr>
                                <td>${new Date(stat.matchDate).toLocaleDateString()}</td>
                                <td>${stat.competitionName}</td>
                                <td>${stat.opponent ? stat.opponent.name : 'N/A'}</td>
                                <td>-</td>
                                <td>${stat.minutesPlayed}</td>
                                <td>${stat.goals}</td>
                                <td>${stat.assists}</td>
                                <td>${stat.playerRating ? stat.playerRating.toFixed(2) : 'N/A'}</td>
                            </tr>`;
                        });

                        table += '</tbody></table>';
                        statsContainer.innerHTML = table;
                    } else {
                        statsContainer.innerHTML = '<p>No match data available for this season.</p>';
                    }
                })
                .catch(error => {
                    console.error('Error fetching match stats:', error);
                    loadingSpinner.style.display = 'none';
                    statsContainer.innerHTML = '<p>Could not load match stats. Please try again later.</p>';
                    button.disabled = false;
                });
        });
    </script>
</div>
</body>
</html> 